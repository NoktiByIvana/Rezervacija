<!doctype html>
<html lang="sr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nokti by Ivana ‚Äî Rezervacija termina</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<style>
:root{
  --bg:#fffafc;
  --card:#ffffff;
  --accent:#e4a6c1;
  --text:#333;
  --muted:#777;
  --border:#f1e3eb;
  --shadow:0 6px 20px rgba(0,0,0,0.08);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:var(--bg);
  color:var(--text);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  min-height:100vh;
  padding:20px;
  position:relative; /* keep above canvas */
  z-index:1;
}

.container{
  width:100%;
  max-width:520px;
  position:relative;
  z-index:1;
}

header{
  display:flex;
  align-items:center;
  gap:16px;
  margin-bottom:16px;
  flex-wrap:wrap;
}

.logo{
  width:200px;
  height:200px;
  display:flex;
  overflow:hidden;
  margin-bottom:0;
}

.logo img{
  width:100%;
  height:100%;
  object-fit:contain;
}

h1{
  font-size:30px;
  color:var(--accent);
  margin:0;
}

p.lead{
  margin:0;
  color:var(--text);
  font-size:20px;
}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:18px;
  box-shadow:var(--shadow);
  padding:20px;
  position:relative;
  z-index:1;
}

form{
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
}

label{
  font-size:13px;
  color:var(--muted);
  margin-bottom:4px;
  display:block;
}

input[type=text],input[type=tel],select,textarea{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid var(--border);
  font-size:15px;
  color:var(--text);
  background:#fff;
}

textarea{
  min-height:80px;
  resize:vertical;
}

button{
  background:var(--accent);
  color:#fff;
  border:none;
  border-radius:10px;
  padding:12px 16px;
  font-weight:600;
  cursor:pointer;
  font-size:15px;
}

button.secondary{
  background:#fff;
  color:var(--accent);
  border:1px solid var(--accent);
}

.actions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:space-between;
  align-items:center;
}

.note{
  font-size:13px;
  color:var(--muted);
  margin-top:6px;
  text-align:center;
}

footer{
  margin-top:16px;
  text-align:center;
  font-size:13px;
  color:var(--muted);
}

option.booked{
  text-decoration:line-through;
  color:#bbb;
}

/* Mobile adjustments */
@media(max-width:480px){
  h1{font-size:20px}
  .card{padding:16px}
  input,select,textarea,button{font-size:14px}
  body{
    padding:10px;
  }
  header{
    flex-direction:column;
    align-items:stretch;
    gap:8px;
  }
  .logo{
    width:150px;
    height:150px;
    margin:0 auto;
  }
}
</style>

</head>
<body>
 

  <div class="container">
    <header>
      <div class="logo" id="logoPlaceholder">
        <img id="logoImg" src="1000005446.png" alt="Logo" >
      </div>
      <div>
        <h1 id="brand">Nokti by Ivana</h1>
        <p class="lead">Rezervi≈°ite svoj termin brzo i lako </p>
      </div>
    </header>

    <div class="card">
      <form id="bookingForm">
        <div>
          <label for="ime">Ime i prezime</label>
          <input id="ime" name="ime" type="text" placeholder="Va≈°e ime" required>
        </div>
        <div>
          <label for="telefon">Broj telefona</label>
          <input id="telefon" name="telefon" type="tel" placeholder="+387 61 123 456" required>
        </div>
        <div>
          <label for="nokt">Vrsta noktiju</label>
          <select id="nokt" name="nokt" required>
            <option value="">‚Äî izaberi ‚Äî</option>
            <option>Du≈æi nokti</option>
            <option>Klasiƒçni (French / Ombre)</option>
            <option>Specijalni dizajn</option>
            <option>Korekcija</option>
          </select>
        </div>
        <div>
          <label for="datum">Datum</label>
          <input id="datum" name="datum" type="text" required>
        </div>
        <div>
          <label for="vreme">Vrijeme</label>
          <select id="vreme" name="vreme" required>
            <option value="">‚Äî izaberi vrijeme ‚Äî</option>
          </select>
        </div>
        <div>
          <label for="poruka">Napomena (opciono)</label>
          <textarea id="poruka" name="poruka" placeholder="Boja, oblik, ≈æelje..."></textarea>
        </div>
        <div class="actions">
          <button id="sendBtn" type="submit">Po≈°alji rezervaciju</button>
          <button id="previewBtn" type="button" class="secondary">Pregled</button>
        </div>
        <div class="note" id="status" style="display:none"></div>
      </form>
      <footer>¬© Nokti by Ivana</footer>
    </div>


    <div class="card" style="margin-top:20px;">
  <h2 style="color:var(--accent);margin-bottom:12px;">Kontakt</h2>
  <p style="margin:0 0 8px;">üìû Telefon: <a href="tel:+38761123456" style="color:var(--accent);text-decoration:none;">+387 61 123 456</a></p>
  <p style="margin:0 0 8px;">üìß Email: <a href="mailto:Noktibyivanaa@gmail.com" style="color:var(--accent);text-decoration:none;">Noktibyivanaa@gmail.com</a></p>
  <p style="margin:0 0 8px;">üìç Adresa: Ulica 123, Grad, BiH</p>
  <div style="margin-top:10px;">
    <a href="https://www.instagram.com/ivanaa_sh?igsh=MW5keWg0and4cWVi" target="_blank" style="color:var(--accent);text-decoration:none;margin-right:12px;">Instagram</a>

  </div>
</div>
  </div>
 <canvas id="bgCanvas" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;"></canvas>

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
const BRAND_NAME = 'Nokti by Ivana';
const LOGO_URL = '';
const FORM_ACTION = 'https://formspree.io/f/manplnba';

const firebaseConfig = {
  apiKey: "AIzaSyAM-UGf-gXs0EccpWpb0LvLHQ4_JPADnd4",
  authDomain: "ivananokti-89ca0.firebaseapp.com",
  projectId: "ivananokti-89ca0",
  storageBucket: "ivananokti-89ca0.firebasestorage.app",
  messagingSenderId: "257836738403",
  appId: "1:257836738403:web:d772b4aa4ab360a7dfd556",
  measurementId: "G-GYGJHVWLVL"
};

const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const form = document.getElementById('bookingForm');
const status = document.getElementById('status');
const previewBtn = document.getElementById('previewBtn');
const vremeSelect = document.getElementById('vreme');


const times = ["13:00","14:00","15:00","16:00","17:00","18:00"];

let fullyBookedDates = []; 

function buildMessage(data){
  return `Rezervacija termina:\n\nIme: ${data.ime}\nTelefon: ${data.telefon}\nNokti: ${data.nokt}\nDatum: ${data.datum}\nVreme: ${data.vreme}\nNapomene: ${data.poruka || '-'}`;
}

previewBtn.addEventListener('click', ()=>{
  const formData = new FormData(form);
  alert(buildMessage(Object.fromEntries(formData.entries())));
});


form.addEventListener('submit', async e=>{
  e.preventDefault();
  status.style.display='block';
  status.textContent='≈†aljem...';
  const formData = new FormData(form);
  const data = Object.fromEntries(formData.entries());

  try {

    const docRef = db.collection('bookedTimes').doc(data.datum);
    await db.runTransaction(async tx=>{
      const doc = await tx.get(docRef);
      const current = doc.exists ? doc.data() : {};
      if(current[data.vreme]) throw new Error('Termin je veƒá zauzet.');
      current[data.vreme] = true;
      tx.set(docRef, current);
    });


    await db.collection('bookings').add({
      date: data.datum,
      time: data.vreme,
      name: data.ime,
      phone: data.telefon,
      type: data.nokt,
      note: data.poruka || '',
      created: Date.now()
    });


    const res = await fetch(FORM_ACTION,{method:'POST',body:formData,headers:{'Accept':'application/json'}});
    if(res.ok){
      status.textContent='‚úÖ Uspe≈°no poslato! Ivana ƒáe vas kontaktirati.';
      form.reset();
      updateAvailableTimes(); 
    } else throw new Error('Gre≈°ka pri slanju.');

  } catch(err){
    console.error(err);
    status.textContent = err.message.includes('zauzet') 
      ? '‚ùå Termin je veƒá zauzet. Molimo izaberite drugo vrjeme.' 
      : '‚ùå Gre≈°ka: ' + err.message;
  }
});


async function updateAvailableTimes(dateStr){
  vremeSelect.innerHTML='<option value="">‚Äî izaberi vrjeme ‚Äî</option>';
  if(!dateStr) return;

  const docRef = db.collection('bookedTimes').doc(dateStr);
  const snap = await docRef.get();
  const bookedTimes = snap.exists ? Object.keys(snap.data()) : [];

  times.forEach(t=>{
    const opt = document.createElement('option');
    opt.value = t;
    opt.textContent = t;
    if(bookedTimes.includes(t)){
      opt.disabled = true;
      opt.classList.add('booked');
    }
    vremeSelect.appendChild(opt);
  });
}


async function getFullyBookedDates(){
  fullyBookedDates = [];
  const snapshot = await db.collection('bookedTimes').get();
  snapshot.docs.forEach(doc=>{
    const data = doc.data();
    const bookedCount = Object.keys(data).length;
    if(bookedCount >= times.length) fullyBookedDates.push(doc.id);
  });
}


async function initCalendar(){
  await getFullyBookedDates();
flatpickr("#datum", {
  minDate: "today",
  dateFormat: "Y-m-d",
  disable: fullyBookedDates,
  disableMobile: true,  // ‚úÖ force Flatpickr UI on all devices
  onChange: (selectedDates, dateStr) => {
    updateAvailableTimes(dateStr);
  }
});

}

initCalendar();



const canvas = document.getElementById('bgCanvas');
const ctx = canvas.getContext('2d');
let width = canvas.width = window.innerWidth;
let height = canvas.height = window.innerHeight;


const lines = [];
for(let i=0;i<80;i++){
  lines.push({
    x: Math.random()*width,
    y: Math.random()*height,
    length: 50 + Math.random()*100,
    angle: Math.random()*2*Math.PI,
    speed: 0.3 + Math.random()*0.7,
    color: 'rgba(228,166,193,0.6)' 
  });
}

function animate(){
  ctx.clearRect(0,0,width,height);
  lines.forEach(line=>{
    ctx.beginPath();
    ctx.moveTo(line.x, line.y);
    ctx.lineTo(line.x + Math.cos(line.angle)*line.length, line.y + Math.sin(line.angle)*line.length);
    ctx.strokeStyle = line.color;
    ctx.lineWidth = 1.5;
    ctx.stroke();


    line.x += Math.cos(line.angle)*line.speed;
    line.y += Math.sin(line.angle)*line.speed;


    if(line.x>width+line.length) line.x=-line.length;
    if(line.x<-line.length) line.x=width+line.length;
    if(line.y>height+line.length) line.y=-line.length;
    if(line.y<-line.length) line.y=height+line.length;
  });
  requestAnimationFrame(animate);
}
animate();


window.addEventListener('resize', ()=>{
  width = canvas.width = window.innerWidth;
  height = canvas.height = window.innerHeight;
});

</script>


</body>
</html>
